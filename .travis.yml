os: linux
services: docker
dist: jammy
language: go
env:
  global:
    - DEFAULT_BRANCH: kmr2-5.2.7
    - GOPROXY: https://proxy.golang.org,https://goproxy.io,direct

jobs:
  include:
    - stage: build-images
      if: tag IS present
      go: 1.20.x
      go_import_path: github.com/noironetworks/aci-containers
      before_script:
        - export DOCKER_BUILDKIT=1
        - export RELEASE_TAG=5.2.7.1
        - export UPSTREAM_ID=81c2369
        - export EXPECTED_TAG_PREFIX=${RELEASE_TAG}
      script:
        - echo "Skip running UTs"
        - git clone http://www.github.com/noironetworks/cicd -b kmr2-5.2.7 /tmp/cicd
        - /tmp/cicd/travis/check-git-tag.sh; RETURN_CODE=$? ; if [ $RETURN_CODE -eq 140 ]; then travis_terminate 0; elif [ $RETURN_CODE -ne 0 ]; then travis_terminate $RETURN_CODE; fi
        - /tmp/cicd/travis/build-push-aci-containers-images.sh || travis_terminate 1
